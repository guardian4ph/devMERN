{"ast":null,"code":"export async function send(title = \"GUARDIAN NOTIFICATION\", body = \"Incident Alert\") {\n  console.log(\"Hit by Frontend\");\n  const register = await navigator.serviceWorker.register(\"/ws.js\", {\n    scope: \"/\"\n  });\n  console.log(\"Service worker Registering...\");\n\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(function (registration) {\n      if (!registration.pushManager) {\n        return;\n      }\n\n      registration.pushManager.getSubscription().then(function (existedSubscription) {\n        if (existedSubscription === null) {\n          registration.pushManager.subscribe({\n            applicationServerKey: urlBase64ToUint8Array(process.env.REACT_APP_PUBLIC_VAPID_KEY),\n            userVisibleOnly: true\n          }).then(function (newSubscription) {\n            sendSubscription(newSubscription, title, body);\n          }).catch(function (e) {\n            if (Notification.permission !== \"granted\") {} else {\n              console.error(e);\n            }\n          });\n        } else {\n          sendSubscription(existedSubscription, title, body);\n        }\n      });\n    }).catch(function (e) {\n      console.error(e);\n    });\n  }\n}\n\nfunction sendSubscription(subscription, title, body) {\n  return fetch(\"/api/subscribe\", {\n    method: \"POST\",\n    body: JSON.stringify({\n      subscription,\n      title,\n      body\n    }),\n    headers: {\n      \"content-type\": \"application/json\"\n    }\n  });\n}\n\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = \"=\".repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding).replace(/\\-/g, \"+\")\n  /* eslint-disable-line */\n  .replace(/_/g, \"/\");\n  /* eslint-disable-line */\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}","map":{"version":3,"sources":["D:/1App/client/src/utils/push.js"],"names":["send","title","body","console","log","register","navigator","serviceWorker","scope","ready","then","registration","pushManager","getSubscription","existedSubscription","subscribe","applicationServerKey","urlBase64ToUint8Array","process","env","REACT_APP_PUBLIC_VAPID_KEY","userVisibleOnly","newSubscription","sendSubscription","catch","e","Notification","permission","error","subscription","fetch","method","JSON","stringify","headers","base64String","padding","repeat","length","base64","replace","rawData","window","atob","outputArray","Uint8Array","i","charCodeAt"],"mappings":"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","sourcesContent":["export async function send(\r\n  title = \"GUARDIAN NOTIFICATION\",\r\n  body = \"Incident Alert\"\r\n) {\r\n  console.log(\"Hit by Frontend\");\r\n  const register = await navigator.serviceWorker.register(\"/ws.js\", {\r\n    scope: \"/\",\r\n  });\r\n  console.log(\"Service worker Registering...\");\r\n  if (\"serviceWorker\" in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(function (registration) {\r\n        if (!registration.pushManager) {\r\n          return;\r\n        }\r\n        registration.pushManager\r\n          .getSubscription()\r\n          .then(function (existedSubscription) {\r\n            if (existedSubscription === null) {\r\n              registration.pushManager\r\n                .subscribe({\r\n                  applicationServerKey: urlBase64ToUint8Array(\r\n                    process.env.REACT_APP_PUBLIC_VAPID_KEY\r\n                  ),\r\n                  userVisibleOnly: true,\r\n                })\r\n                .then(function (newSubscription) {\r\n                  sendSubscription(newSubscription, title, body);\r\n                })\r\n                .catch(function (e) {\r\n                  if (Notification.permission !== \"granted\") {\r\n                  } else {\r\n                    console.error(e);\r\n                  }\r\n                });\r\n            } else {\r\n              sendSubscription(existedSubscription, title, body);\r\n            }\r\n          });\r\n      })\r\n      .catch(function (e) {\r\n        console.error(e);\r\n      });\r\n  }\r\n}\r\n\r\nfunction sendSubscription(subscription, title, body) {\r\n  return fetch(\"/api/subscribe\", {\r\n    method: \"POST\",\r\n    body: JSON.stringify({ subscription, title, body }),\r\n    headers: {\r\n      \"content-type\": \"application/json\",\r\n    },\r\n  });\r\n}\r\n\r\nfunction urlBase64ToUint8Array(base64String) {\r\n  const padding = \"=\".repeat((4 - (base64String.length % 4)) % 4);\r\n  const base64 = (base64String + padding)\r\n    .replace(/\\-/g, \"+\") /* eslint-disable-line */\r\n    .replace(/_/g, \"/\"); /* eslint-disable-line */\r\n\r\n  const rawData = window.atob(base64);\r\n  const outputArray = new Uint8Array(rawData.length);\r\n\r\n  for (let i = 0; i < rawData.length; ++i) {\r\n    outputArray[i] = rawData.charCodeAt(i);\r\n  }\r\n  return outputArray;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}