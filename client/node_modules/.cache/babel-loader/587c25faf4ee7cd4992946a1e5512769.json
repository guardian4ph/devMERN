{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar axios_1 = require(\"axios\");\n\nvar md5 = require(\"js-md5\");\n\nvar js_sha256_1 = require(\"js-sha256\");\n\nvar js_sha512_1 = require(\"js-sha512\");\n\nvar AxiosDigest = function () {\n  function AxiosDigest(username, passwd, customAxios) {\n    this.axios = customAxios !== undefined ? customAxios : axios_1.default;\n    this.username = username;\n    this.passwd = passwd;\n  }\n\n  Object.defineProperty(AxiosDigest.prototype, \"info\", {\n    get: function () {\n      return {\n        username: this.username,\n        passwd: '***'\n      };\n    },\n    set: function (d) {\n      this.username = d.username;\n      this.passwd = d.passwd;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  AxiosDigest.prototype.get = function (path, config) {\n    return __awaiter(this, void 0, void 0, function () {\n      var v_1, c;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4, this.axios.get(path, config)];\n\n          case 1:\n            return [2, _a.sent()];\n\n          case 2:\n            v_1 = _a.sent();\n            c = this.getAuthHeader(this.getWwwAuth(v_1), 'GET', path, config);\n            return [2, this.axios.get(path, c)];\n\n          case 3:\n            return [2];\n        }\n      });\n    });\n  };\n\n  AxiosDigest.prototype.post = function (path, data, config) {\n    return __awaiter(this, void 0, void 0, function () {\n      var v_2, c;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4, this.axios.post(path, data, config)];\n\n          case 1:\n            return [2, _a.sent()];\n\n          case 2:\n            v_2 = _a.sent();\n            c = this.getAuthHeader(this.getWwwAuth(v_2), 'POST', path, config);\n            return [2, this.axios.post(path, data, c)];\n\n          case 3:\n            return [2];\n        }\n      });\n    });\n  };\n\n  AxiosDigest.prototype.put = function (path, data, config) {\n    return __awaiter(this, void 0, void 0, function () {\n      var v_3, c;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4, this.axios.put(path, data, config)];\n\n          case 1:\n            return [2, _a.sent()];\n\n          case 2:\n            v_3 = _a.sent();\n            c = this.getAuthHeader(this.getWwwAuth(v_3), 'PUT', path, config);\n            return [2, this.axios.put(path, data, c)];\n\n          case 3:\n            return [2];\n        }\n      });\n    });\n  };\n\n  AxiosDigest.prototype.delete = function (path, config) {\n    return __awaiter(this, void 0, void 0, function () {\n      var v_4, c;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4, this.axios.delete(path, config)];\n\n          case 1:\n            return [2, _a.sent()];\n\n          case 2:\n            v_4 = _a.sent();\n            c = this.getAuthHeader(this.getWwwAuth(v_4), 'DELETE', path, config);\n            return [2, this.axios.delete(path, c)];\n\n          case 3:\n            return [2];\n        }\n      });\n    });\n  };\n\n  AxiosDigest.prototype.head = function (path, config) {\n    var _this = this;\n\n    return this.axios.head(path, config).catch(this.getWwwAuth).then(function (wwwAuth) {\n      var c = _this.getAuthHeader(wwwAuth, 'HEAD', path, config);\n\n      return _this.axios.head(path, c);\n    });\n  };\n\n  AxiosDigest.prototype.patch = function (path, data, config) {\n    var _this = this;\n\n    return this.axios.patch(path, data, config).catch(this.getWwwAuth).then(function (wwwAuth) {\n      var c = _this.getAuthHeader(wwwAuth, 'PATCH', path, config);\n\n      return _this.axios.patch(path, data, c);\n    });\n  };\n\n  AxiosDigest.prototype.getWwwAuth = function (r) {\n    var status = r.response.status;\n\n    if (status === 401) {\n      return r.response.headers['www-authenticate'];\n    }\n\n    throw r;\n  };\n\n  AxiosDigest.prototype.getAuthHeader = function (authHeader, method, url, config) {\n    var paramsString = authHeader.split(/\\s*,?\\s*Digest\\s*/).filter(function (v) {\n      return v !== '';\n    });\n    var paramsArray = paramsString.map(function (v) {\n      return v.split(/\\s*,(?=(?:[^\"]*\"[^\"]*\")*)\\s*/);\n    });\n    var paramsKvArray = paramsArray.map(function (v) {\n      return v.map(function (value) {\n        var ret = value.split(/\\s*=(?:(?=[^\"]*\"[^\"]*\")|(?!\"))\\s*/, 2).map(function (v2) {\n          return v2.replace(/^\"/, '').replace(/\"$/, '');\n        });\n        return [ret[0], ret[1]];\n      });\n    });\n    var paramsMapArray = paramsKvArray.map(function (v) {\n      var t = {};\n      v.forEach(function (w) {\n        t[w[0]] = w[1];\n      });\n      return t;\n    });\n    var calams = ['realm', 'nonce', 'qop', 'opaque'];\n    var paramsCalamsOk = paramsMapArray.map(function (v) {\n      if (!('algorithm' in v)) {\n        v.algorithm = 'MD5';\n      }\n\n      return v;\n    }).filter(function (v) {\n      return ['MD5', 'SHA-256', 'SHA-512-256', 'SHA-512'].findIndex(function (i) {\n        return i === v.algorithm;\n      }) >= 0;\n    }).filter(function (v) {\n      return calams.filter(function (value) {\n        return !(value in v);\n      }).length === 0;\n    }).filter(function (v) {\n      return v.qop.split(/\\s*,\\s*/).filter(function (v2) {\n        return v2 === 'auth';\n      }).length !== 0;\n    });\n\n    if (paramsCalamsOk.length === 0) {\n      throw new Error('Auth params error.');\n    }\n\n    paramsCalamsOk.sort(function (a, b) {\n      var _a = [a.algorithm, b.algorithm].map(function (v) {\n        if (v === 'MD5') return 0;\n        if (v === 'SHA-256') return 1;\n        if (v === 'SHA-512-256') return 2;\n        return 3;\n      }),\n          aEval = _a[0],\n          bEval = _a[1];\n\n      return bEval - aEval;\n    });\n    var params = paramsCalamsOk[0];\n    var username = this.username;\n    var passwd = this.passwd;\n    var realm = params.realm,\n        nonce = params.nonce,\n        opaque = params.opaque,\n        algorithm = params.algorithm;\n    var uri = url.split(/^https?:\\/\\/[^/]+/).filter(function (v) {\n      return v !== '';\n    })[0];\n    var cnonce = Math.random().toString(32).substring(2);\n    var nc = '0001';\n    var qop = 'auth';\n\n    var hashHex = function () {\n      if (algorithm === 'MD5') return md5;\n      if (algorithm === 'SHA-256') return js_sha256_1.sha256;\n      if (algorithm === 'SHA-512-256') return js_sha512_1.sha512_256;\n      return js_sha512_1.sha512;\n    }();\n\n    var hashHexArray = function (data) {\n      return hashHex(data.join(':'));\n    };\n\n    var a1 = [username, realm, passwd];\n    var a1hash = hashHexArray(a1);\n    var a2 = [method, uri];\n    var a2hash = hashHexArray(a2);\n    var a3 = [a1hash, nonce, nc, cnonce, qop, a2hash];\n    var response = hashHexArray(a3);\n    var dh = {\n      realm: realm,\n      nonce: nonce,\n      uri: uri,\n      username: username,\n      cnonce: cnonce,\n      nc: nc,\n      qop: qop,\n      algorithm: algorithm,\n      response: response,\n      opaque: opaque\n    };\n    var auth = \"Digest \" + Object.keys(dh).map(function (v) {\n      return v + \"=\\\"\" + dh[v] + \"\\\"\";\n    }).join(', ');\n\n    if (config === undefined) {\n      return {\n        headers: {\n          Authorization: auth\n        }\n      };\n    }\n\n    config.headers.Authorization = auth;\n    return config;\n  };\n\n  return AxiosDigest;\n}();\n\nexports.default = AxiosDigest;","map":{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar axios_1 = require(\"axios\");\nvar md5 = require(\"js-md5\");\nvar js_sha256_1 = require(\"js-sha256\");\nvar js_sha512_1 = require(\"js-sha512\");\nvar AxiosDigest = (function () {\n    function AxiosDigest(username, passwd, customAxios) {\n        this.axios = customAxios !== undefined ? customAxios : axios_1.default;\n        this.username = username;\n        this.passwd = passwd;\n    }\n    Object.defineProperty(AxiosDigest.prototype, \"info\", {\n        get: function () {\n            return { username: this.username, passwd: '***' };\n        },\n        set: function (d) {\n            this.username = d.username;\n            this.passwd = d.passwd;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AxiosDigest.prototype.get = function (path, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var v_1, c;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4, this.axios.get(path, config)];\n                    case 1: return [2, _a.sent()];\n                    case 2:\n                        v_1 = _a.sent();\n                        c = this.getAuthHeader(this.getWwwAuth(v_1), 'GET', path, config);\n                        return [2, this.axios.get(path, c)];\n                    case 3: return [2];\n                }\n            });\n        });\n    };\n    AxiosDigest.prototype.post = function (path, data, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var v_2, c;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4, this.axios.post(path, data, config)];\n                    case 1: return [2, _a.sent()];\n                    case 2:\n                        v_2 = _a.sent();\n                        c = this.getAuthHeader(this.getWwwAuth(v_2), 'POST', path, config);\n                        return [2, this.axios.post(path, data, c)];\n                    case 3: return [2];\n                }\n            });\n        });\n    };\n    AxiosDigest.prototype.put = function (path, data, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var v_3, c;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4, this.axios.put(path, data, config)];\n                    case 1: return [2, _a.sent()];\n                    case 2:\n                        v_3 = _a.sent();\n                        c = this.getAuthHeader(this.getWwwAuth(v_3), 'PUT', path, config);\n                        return [2, this.axios.put(path, data, c)];\n                    case 3: return [2];\n                }\n            });\n        });\n    };\n    AxiosDigest.prototype.delete = function (path, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var v_4, c;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4, this.axios.delete(path, config)];\n                    case 1: return [2, _a.sent()];\n                    case 2:\n                        v_4 = _a.sent();\n                        c = this.getAuthHeader(this.getWwwAuth(v_4), 'DELETE', path, config);\n                        return [2, this.axios.delete(path, c)];\n                    case 3: return [2];\n                }\n            });\n        });\n    };\n    AxiosDigest.prototype.head = function (path, config) {\n        var _this = this;\n        return this.axios.head(path, config).catch(this.getWwwAuth).then(function (wwwAuth) {\n            var c = _this.getAuthHeader(wwwAuth, 'HEAD', path, config);\n            return _this.axios.head(path, c);\n        });\n    };\n    AxiosDigest.prototype.patch = function (path, data, config) {\n        var _this = this;\n        return this.axios.patch(path, data, config).catch(this.getWwwAuth).then(function (wwwAuth) {\n            var c = _this.getAuthHeader(wwwAuth, 'PATCH', path, config);\n            return _this.axios.patch(path, data, c);\n        });\n    };\n    AxiosDigest.prototype.getWwwAuth = function (r) {\n        var status = r.response.status;\n        if (status === 401) {\n            return r.response.headers['www-authenticate'];\n        }\n        throw r;\n    };\n    AxiosDigest.prototype.getAuthHeader = function (authHeader, method, url, config) {\n        var paramsString = authHeader.split(/\\s*,?\\s*Digest\\s*/).filter(function (v) { return v !== ''; });\n        var paramsArray = paramsString.map(function (v) { return v.split(/\\s*,(?=(?:[^\"]*\"[^\"]*\")*)\\s*/); });\n        var paramsKvArray = paramsArray.map(function (v) { return v.map(function (value) {\n            var ret = value.split(/\\s*=(?:(?=[^\"]*\"[^\"]*\")|(?!\"))\\s*/, 2).map(function (v2) { return v2.replace(/^\"/, '').replace(/\"$/, ''); });\n            return [ret[0], ret[1]];\n        }); });\n        var paramsMapArray = paramsKvArray.map(function (v) {\n            var t = {};\n            v.forEach(function (w) {\n                t[w[0]] = w[1];\n            });\n            return t;\n        });\n        var calams = ['realm', 'nonce', 'qop', 'opaque'];\n        var paramsCalamsOk = paramsMapArray.map(function (v) {\n            if (!('algorithm' in v)) {\n                v.algorithm = 'MD5';\n            }\n            return v;\n        }).filter(function (v) { return ['MD5', 'SHA-256', 'SHA-512-256', 'SHA-512'].findIndex(function (i) { return i === v.algorithm; }) >= 0; })\n            .filter(function (v) { return calams.filter(function (value) { return !(value in v); }).length === 0; })\n            .filter(function (v) { return v.qop.split(/\\s*,\\s*/).filter(function (v2) { return v2 === 'auth'; }).length !== 0; });\n        if (paramsCalamsOk.length === 0) {\n            throw new Error('Auth params error.');\n        }\n        paramsCalamsOk.sort(function (a, b) {\n            var _a = [a.algorithm, b.algorithm].map(function (v) {\n                if (v === 'MD5')\n                    return 0;\n                if (v === 'SHA-256')\n                    return 1;\n                if (v === 'SHA-512-256')\n                    return 2;\n                return 3;\n            }), aEval = _a[0], bEval = _a[1];\n            return bEval - aEval;\n        });\n        var params = paramsCalamsOk[0];\n        var username = this.username;\n        var passwd = this.passwd;\n        var realm = params.realm, nonce = params.nonce, opaque = params.opaque, algorithm = params.algorithm;\n        var uri = url.split(/^https?:\\/\\/[^/]+/).filter(function (v) { return v !== ''; })[0];\n        var cnonce = Math.random().toString(32).substring(2);\n        var nc = '0001';\n        var qop = 'auth';\n        var hashHex = (function () {\n            if (algorithm === 'MD5')\n                return md5;\n            if (algorithm === 'SHA-256')\n                return js_sha256_1.sha256;\n            if (algorithm === 'SHA-512-256')\n                return js_sha512_1.sha512_256;\n            return js_sha512_1.sha512;\n        })();\n        var hashHexArray = function (data) { return hashHex(data.join(':')); };\n        var a1 = [username, realm, passwd];\n        var a1hash = hashHexArray(a1);\n        var a2 = [method, uri];\n        var a2hash = hashHexArray(a2);\n        var a3 = [a1hash, nonce, nc, cnonce, qop, a2hash];\n        var response = hashHexArray(a3);\n        var dh = {\n            realm: realm,\n            nonce: nonce,\n            uri: uri,\n            username: username,\n            cnonce: cnonce,\n            nc: nc,\n            qop: qop,\n            algorithm: algorithm,\n            response: response,\n            opaque: opaque,\n        };\n        var auth = \"Digest \" + Object.keys(dh).map(function (v) { return v + \"=\\\"\" + dh[v] + \"\\\"\"; }).join(', ');\n        if (config === undefined) {\n            return { headers: { Authorization: auth } };\n        }\n        config.headers.Authorization = auth;\n        return config;\n    };\n    return AxiosDigest;\n}());\nexports.default = AxiosDigest;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}